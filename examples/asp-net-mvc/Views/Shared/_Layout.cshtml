<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - My ASP.NET MVC App</title>
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>
    <header>
        <nav>
            <!-- Your navigation here -->
        </nav>
    </header>
    
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer>
        <!-- Your footer here -->
    </footer>

    @RenderSection("Scripts", required: false)

    <!-- CandleStick Session Tracker SDK -->
    @if (Configuration.GetValue<bool>("CandleStick:Enabled"))
    {
        @* For local development, use the viewer app URL *@
        @* For production, host the SDK file on your CDN *@
        <script src="http://localhost:3000/session-tracker.umd.js"></script>
        <script>
            (function() {
                try {
                    // Initialize CandleStick tracker
                    window.candleStickTracker = SessionTracker.init({
                        apiEndpoint: '@Configuration["CandleStick:ApiEndpoint"]',
                        userId: '@User.Identity.Name',
                        userName: '@User.Claims.FirstOrDefault(c => c.Type == "name")?.Value',
                        userEmail: '@User.Claims.FirstOrDefault(c => c.Type == "email")?.Value',
                        appName: 'My ASP.NET MVC App',
                        
                        // Opt-in mode: Shows a widget that lets users control recording
                        // Set to false for automatic recording (default)
                        optIn: @(Configuration.GetValue<bool>("CandleStick:OptInMode", false).ToString().ToLower()),
                        showWidget: @(Configuration.GetValue<bool>("CandleStick:OptInMode", false).ToString().ToLower()),
                        
                        metadata: {
                            environment: '@Environment.EnvironmentName',
                            userRole: '@User.IsInRole("Admin") ? "Admin" : "User"'
                        }
                    });
                    
                    if (window.candleStickTracker) {
                        console.log('‚úÖ CandleStick initialized');
                        console.log('üìπ Session ID:', window.candleStickTracker.getSessionId());
                        console.log('üëÅÔ∏è  View your session at: http://localhost:3000');
                        
                        @if (Configuration.GetValue<bool>("CandleStick:OptInMode", false))
                        {
                            @:console.log('üéõÔ∏è  Opt-in mode: Click the candle widget to start recording');
                        }
                        else
                        {
                            @:console.log('üé• Auto-recording started');
                        }
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è  CandleStick failed to initialize:', error);
                }
            })();
        </script>
    }
    else
    {
        <!-- CandleStick tracking is disabled in this environment -->
    }

</body>
</html>
